require 'rails_helper'

RSpec.describe 'Merchant API', type: :request do
  describe 'GET /api/v1/merchants' do
    it 'returns all merchants' do
      create_list(:merchant, 5)

      get '/api/v1/merchants'

      expect(response).to have_http_status(:success)
      expect(JSON.parse(response.body).size).to eq(5)

      merchant = JSON.parse(response.body)
      merchant1_data = merchant['data'].find { |merchant| merchant['id'] == "@merchant1.id"} [atributes]
      expect(merchant1_data['name']).to eq(@merchant1.name)
      expect(merchant1_data["description"]).to eq("This is a description")
      expect(merchant1_data["unit_price"]).to eq(1.5)
      expect(merchant1_data['id']).to eq(@merchant1.id)

      merchant2_data = merchant['data'].find { |merchant| merchant['id'] == "@merchant2.id"} [atributes]
      expect(merchant2_data['name']).to eq(@merchant2.name)
    end
  end
end
